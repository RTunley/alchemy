<!--
Renders a form for question editing.

form: the form object
form_prefix: a prefix to identify the form on the page
form_action: the form submit action
question_id: the id of the question if editing a question, otherwise an empty string
-->

{% macro render_question_form(form, form_prefix, form_action, question_id) -%}

<form method="POST" action="{{ form_action }}" enctype="multipart/form-data">
  {{ form.hidden_tag() }}
  <div class="form-row">
    <div class="col-md-9 mb-3">
      {{ form.content.label(class="form-control-label") }}
      {{ form.content(class="form-control", rows="4") }}
    </div>
    <div class="col-md-3 mb-3">
      <label for="{{ form_prefix }}new_tag_field">New Tag</label>
      <input type="text" class="form-control mb-2" id="{{ form_prefix }}new_tag_field">
      <button class="btn btn-success" id="{{ form_prefix }}newTag" type="button">Add Tag</button>
    </div>
  </div>
  <div class="form-row">
    <div class="col-md-9 mb-3">
      <!-- {{ form.solution.label(class="form-control-label") }} -->


      <ul class="nav nav-tabs justify-content-center" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link" id="{{ form_prefix }}solution_text_tab" data-toggle="tab" href="#{{ form_prefix }}solution_text_div" role="tab" aria-controls="{{ form_prefix }}solution_text_div" aria-selected="true"><span data-feather="type"></span> Text solution</a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link active" id="{{ form_prefix }}solution_choices_tab" data-toggle="tab" href="#{{ form_prefix }}solution_choices_div" role="tab" aria-controls="{{ form_prefix }}solution_choices_div" aria-selected="false"><span data-feather="list"></span> Multiple choice solution</a>
        </li>
      </ul>
      <div class="tab-content pt-3">
        <div class="tab-pane" id="{{ form_prefix }}solution_text_div" role="tabpanel" aria-labelledby="{{ form_prefix }}solution_text_tab">
          {{ form.solution(class="form-control", rows="4") }}
        </div>
        <div class="tab-pane show active" id="{{ form_prefix }}solution_choices_div" role="tabpanel" aria-labelledby="{{ form_prefix }}solution_choices_tab">

        <!-- TODO this needs to use JS to dynamically add and remove choices -->
        {% for solution_choice_label, solution_choice_text in form.solution_choices %}
          <div class="input-group mb-1">
            <div class="input-group-prepend">
              <div class="input-group-text">
                {{ solution_choice_label }} &nbsp;<input type="radio" name="multiple_choice_radio_group" aria-label="Radio button for following text input" onclick="getElementById('{{ form_prefix }}correct_solution_choice').innerText='{{ solution_choice_label }}';">
              </div>
            </div>
            <input type="text" class="form-control" aria-label="Text input with radio button" placeholder="Option text" value="{{ solution_choice_text }}">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button"><span data-feather="trash-2"></span></button>
            </div>
          </div>
        {% endfor %}

          <div class="input-group my-3">
            <input type="text" class="form-control" aria-label="Text input to add another option" placeholder="Add another option...">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button"><span data-feather="plus"></span></button>
            </div>
          </div>

          <p>Correct answer: <span id="{{ form_prefix }}correct_solution_choice">(Not selected)</span></p>

        </div>
      </div>

      <hr />
    </div>


    <div class="col-md-3 mb-3" id="{{ form_prefix }}course_tags">
      <label>Available Tags</label><br />
    </div>
  </div>
  <div class="form-row">
    <div class="col-md-3 mb-3">
      {{ form.points.label(class="form-control-label") }}
      {{ form.points(class="form-control") }}
      {% if form.points.errors %}
        {% for error in form.points.errors %}
          <span class='test-danger'>{{ error }}</span><br>
        {% endfor %}
      {% endif %}
    </div>
    <div class="col-md-9 mb-3" id="{{ form_prefix }}question-tags">
      <label>Tagged:</label><br />
    </div>
  </div>
  <input type="hidden" name="question_id" value="{{ question_id }}" />
  <div class="mb-3">
    {{ form.image.label(class="form-control-label") }}
    {{ form.image(class='btn btn-outline-success btn-block', accept='image/*') }}
    {% if form.image.errors %}
      {% for error in form.image.errors %}
        <span class='test-danger'>{{ error }}</span><br>
      {% endfor %}
    {% endif %}
  </div>
  {{ form.submit(class="btn btn-primary", type="submit")}}
</form>

{%- endmacro %}
